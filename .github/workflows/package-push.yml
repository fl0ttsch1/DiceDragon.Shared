name: Push Package

# Configures this workflow to run every time a change is pushed to the branch called `release`.
on:
  push:
    branches: ['master']

# Defines two custom environment variables for the workflow. These are used for the Container registry domain, and a name for the Docker image that this workflow builds.
env:
  DOTNET_VERSION: '7.0.400'

# There is a single job in this workflow. It's configured to run on the latest available version of Ubuntu.
jobs:
  build-and-push-image:
    runs-on: ubuntu-latest
    # Sets the permissions granted to the `GITHUB_TOKEN` for the actions in this job.
    permissions:
      contents: read
      packages: write
      # 
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        
      - name: Setup .NET Core
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: ${{ env.DOTNET_VERSION }}

      - name: Pack
        run: dotnet pack -c Release

      #- name: Source
      #  run: dotnet nuget add source --name github -n fl0ttsch1 -p ${{ secrets.GITHUB_TOKEN }} "https://nuget.pkg.github.com/fl0ttsch1/index.json"

      - name: Push
        run: dotnet nuget push **\*.nupkg -k "${{ secrets.GITHUB_TOKEN }}" -s "https://nuget.pkg.github.com/fl0ttsch1/index.json"
